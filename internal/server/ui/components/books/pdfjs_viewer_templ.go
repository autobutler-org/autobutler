// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.943
package books

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import "path/filepath"

func PDFJSViewer(filePath string) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<div id=\"pdfjs-viewer-container\" class=\"pdfjs-viewer-container\"><canvas id=\"pdfjs-canvas\"></canvas><div class=\"pdfjs-controls\"><button id=\"pdfjs-prev\" class=\"pdfjs-btn\">‹ Prev</button> <span id=\"pdfjs-page-info\" class=\"pdfjs-page-info\"></span> <button id=\"pdfjs-next\" class=\"pdfjs-btn\">Next ›</button></div></div><script type=\"module\">\n\t\timport * as pdfjsLib from '/public/vendor/pdfjs/pdf.min.mjs';\n\t\t\n\t\t// Set worker path - PDF.js requires a worker for rendering\n\t\tpdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/5.4.149/pdf.worker.min.mjs';\n\n\t\tconst url = ")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Var2, templ_7745c5c3_Err := templruntime.ScriptContentOutsideStringLiteral(filepath.Join("/api/v1/files", filePath))
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/server/ui/components/books/pdfjs_viewer.templ`, Line: 20, Col: 57}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var2)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, ";\n\t\tconst canvas = document.getElementById('pdfjs-canvas');\n\t\tconst ctx = canvas.getContext('2d');\n\t\tconst pageInfo = document.getElementById('pdfjs-page-info');\n\t\tconst prevBtn = document.getElementById('pdfjs-prev');\n\t\tconst nextBtn = document.getElementById('pdfjs-next');\n\n\t\tlet pdfDoc = null;\n\t\tlet pageNum = 1;\n\t\tlet pageRendering = false;\n\t\tlet pageNumPending = null;\n\n\t\t// Calculate scale based on device\n\t\tfunction getScale() {\n\t\t\tconst containerWidth = document.getElementById('pdfjs-viewer-container').clientWidth;\n\t\t\t// Scale to fit container width, 612 is standard PDF page width in points\n\t\t\treturn containerWidth / 612;\n\t\t}\n\n\t\tlet scale = getScale();\n\n\t\tfunction renderPage(num) {\n\t\t\tpageRendering = true;\n\t\t\tpdfDoc.getPage(num).then(function(page) {\n\t\t\t\tconst viewport = page.getViewport({ scale: scale });\n\t\t\t\tcanvas.height = viewport.height;\n\t\t\t\tcanvas.width = viewport.width;\n\n\t\t\t\tconst renderContext = {\n\t\t\t\t\tcanvasContext: ctx,\n\t\t\t\t\tviewport: viewport\n\t\t\t\t};\n\n\t\t\t\tconst renderTask = page.render(renderContext);\n\t\t\t\trenderTask.promise.then(function() {\n\t\t\t\t\tpageRendering = false;\n\t\t\t\t\tif (pageNumPending !== null) {\n\t\t\t\t\t\trenderPage(pageNumPending);\n\t\t\t\t\t\tpageNumPending = null;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tpageInfo.textContent = `Page $${num} of $${pdfDoc.numPages}`;\n\t\t\tprevBtn.disabled = (num <= 1);\n\t\t\tnextBtn.disabled = (num >= pdfDoc.numPages);\n\t\t}\n\n\t\tfunction queueRenderPage(num) {\n\t\t\tif (pageRendering) {\n\t\t\t\tpageNumPending = num;\n\t\t\t} else {\n\t\t\t\trenderPage(num);\n\t\t\t}\n\t\t}\n\n\t\tprevBtn.addEventListener('click', function() {\n\t\t\tif (pageNum <= 1) return;\n\t\t\tpageNum--;\n\t\t\tqueueRenderPage(pageNum);\n\t\t});\n\n\t\tnextBtn.addEventListener('click', function() {\n\t\t\tif (pageNum >= pdfDoc.numPages) return;\n\t\t\tpageNum++;\n\t\t\tqueueRenderPage(pageNum);\n\t\t});\n\n\t\t// Load PDF\n\t\tconst loadingTask = pdfjsLib.getDocument(url);\n\t\tloadingTask.promise.then(function(pdf) {\n\t\t\tpdfDoc = pdf;\n\t\t\trenderPage(pageNum);\n\t\t}).catch(function(error) {\n\t\t\tconsole.error('Error loading PDF:', error);\n\t\t\tdocument.getElementById('pdfjs-viewer-container').innerHTML = \n\t\t\t\t'<div style=\"padding: 2rem; text-align: center;\">Error loading PDF. <a href=\"' + url + '\" target=\"_blank\">Download instead</a></div>';\n\t\t});\n\n\t\t// Handle resize\n\t\tlet resizeTimeout;\n\t\twindow.addEventListener('resize', function() {\n\t\t\tclearTimeout(resizeTimeout);\n\t\t\tresizeTimeout = setTimeout(function() {\n\t\t\t\tscale = getScale();\n\t\t\t\tif (pdfDoc) {\n\t\t\t\t\trenderPage(pageNum);\n\t\t\t\t}\n\t\t\t}, 250);\n\t\t});\n\t</script>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate

{
  "swagger": "2.0",
  "info": {
    "title": "Customer API",
    "description": "Customer-facing API for authentication, purchases, and account management",
    "version": "1.0.0"
  },
  "host": "customers.yoursite.com",
  "basePath": "/api/v1",
  "schemes": ["https"],
  "consumes": ["application/json"],
  "produces": ["application/json"],
  "securityDefinitions": {
    "bearerAuth": {
      "type": "apiKey",
      "name": "Authorization",
      "in": "header"
    }
  },
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/auth/callback": {
      "post": {
        "tags": ["Authentication"],
        "summary": "Handle Auth0 callback",
        "security": [],
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "code": {
                  "type": "string"
                },
                "state": {
                  "type": "string"
                }
              },
              "required": ["code"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Authentication successful",
            "schema": {
              "$ref": "#/definitions/AuthResponse"
            }
          }
        }
      }
    },
    "/auth/refresh": {
      "post": {
        "tags": ["Authentication"],
        "summary": "Refresh access token",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "refreshToken": {
                  "type": "string"
                }
              },
              "required": ["refreshToken"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Token refreshed",
            "schema": {
              "$ref": "#/definitions/AuthResponse"
            }
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": ["Authentication"],
        "summary": "Logout user",
        "responses": {
          "200": {
            "description": "Logged out successfully"
          }
        }
      }
    },
    "/profile": {
      "get": {
        "tags": ["Profile"],
        "summary": "Get customer profile",
        "responses": {
          "200": {
            "description": "Customer profile",
            "schema": {
              "$ref": "#/definitions/CustomerProfile"
            }
          }
        }
      },
      "put": {
        "tags": ["Profile"],
        "summary": "Update customer profile",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/CustomerProfileUpdate"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Profile updated",
            "schema": {
              "$ref": "#/definitions/CustomerProfile"
            }
          }
        }
      }
    },
    "/checkout/create-session": {
      "post": {
        "tags": ["Checkout"],
        "summary": "Create Stripe checkout session",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "items": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "productType": {
                        "type": "string",
                        "enum": ["base_product"]
                      },
                      "quantity": {
                        "type": "integer",
                        "default": 1
                      }
                    },
                    "required": ["productType"]
                  }
                },
                "successUrl": {
                  "type": "string",
                  "format": "uri"
                },
                "cancelUrl": {
                  "type": "string",
                  "format": "uri"
                }
              },
              "required": ["items", "successUrl", "cancelUrl"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Checkout session created",
            "schema": {
              "type": "object",
              "properties": {
                "sessionId": {
                  "type": "string"
                },
                "url": {
                  "type": "string",
                  "format": "uri"
                }
              }
            }
          }
        }
      }
    },
    "/checkout/success": {
      "post": {
        "tags": ["Checkout"],
        "summary": "Handle successful checkout",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "sessionId": {
                  "type": "string"
                }
              },
              "required": ["sessionId"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Purchase processed",
            "schema": {
              "$ref": "#/definitions/Purchase"
            }
          }
        }
      }
    },
    "/purchases": {
      "get": {
        "tags": ["Purchases"],
        "summary": "Get purchase history",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "type": "integer",
            "default": 1
          },
          {
            "name": "limit",
            "in": "query",
            "type": "integer",
            "default": 20
          }
        ],
        "responses": {
          "200": {
            "description": "Purchase history",
            "schema": {
              "type": "object",
              "properties": {
                "purchases": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/Purchase"
                  }
                },
                "pagination": {
                  "$ref": "#/definitions/Pagination"
                }
              }
            }
          }
        }
      }
    },
    "/purchases/{purchaseId}": {
      "get": {
        "tags": ["Purchases"],
        "summary": "Get purchase details",
        "parameters": [
          {
            "name": "purchaseId",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "responses": {
          "200": {
            "description": "Purchase details",
            "schema": {
              "$ref": "#/definitions/Purchase"
            }
          }
        }
      }
    },
    "/billing/payment-methods": {
      "get": {
        "tags": ["Billing"],
        "summary": "Get payment methods",
        "responses": {
          "200": {
            "description": "Payment methods",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/PaymentMethod"
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Billing"],
        "summary": "Add payment method",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "paymentMethodId": {
                  "type": "string"
                }
              },
              "required": ["paymentMethodId"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Payment method added",
            "schema": {
              "$ref": "#/definitions/PaymentMethod"
            }
          }
        }
      }
    },
    "/billing/payment-methods/{paymentMethodId}": {
      "delete": {
        "tags": ["Billing"],
        "summary": "Remove payment method",
        "parameters": [
          {
            "name": "paymentMethodId",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "responses": {
          "200": {
            "description": "Payment method removed"
          }
        }
      }
    },
    "/billing/invoices": {
      "get": {
        "tags": ["Billing"],
        "summary": "Get invoices",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "type": "integer",
            "default": 1
          },
          {
            "name": "limit",
            "in": "query",
            "type": "integer",
            "default": 20
          }
        ],
        "responses": {
          "200": {
            "description": "Invoices",
            "schema": {
              "type": "object",
              "properties": {
                "invoices": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/Invoice"
                  }
                },
                "pagination": {
                  "$ref": "#/definitions/Pagination"
                }
              }
            }
          }
        }
      }
    },
    "/licenses": {
      "get": {
        "tags": ["Licenses"],
        "summary": "Get license keys",
        "responses": {
          "200": {
            "description": "License keys",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/License"
              }
            }
          }
        }
      }
    },
    "/downloads": {
      "get": {
        "tags": ["Downloads"],
        "summary": "Get available downloads",
        "responses": {
          "200": {
            "description": "Available downloads",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/Download"
              }
            }
          }
        }
      }
    },
    "/downloads/{downloadId}/url": {
      "get": {
        "tags": ["Downloads"],
        "summary": "Get signed download URL",
        "parameters": [
          {
            "name": "downloadId",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "responses": {
          "200": {
            "description": "Signed download URL",
            "schema": {
              "type": "object",
              "properties": {
                "url": {
                  "type": "string",
                  "format": "uri"
                },
                "expiresAt": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          }
        }
      }
    },
    "/support/tickets": {
      "get": {
        "tags": ["Support"],
        "summary": "Get support tickets",
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "type": "string",
            "enum": ["open", "pending", "resolved", "closed"]
          },
          {
            "name": "page",
            "in": "query",
            "type": "integer",
            "default": 1
          },
          {
            "name": "limit",
            "in": "query",
            "type": "integer",
            "default": 20
          }
        ],
        "responses": {
          "200": {
            "description": "Support tickets",
            "schema": {
              "type": "object",
              "properties": {
                "tickets": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/SupportTicket"
                  }
                },
                "pagination": {
                  "$ref": "#/definitions/Pagination"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Support"],
        "summary": "Create support ticket",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "subject": {
                  "type": "string",
                  "maxLength": 200
                },
                "description": {
                  "type": "string",
                  "maxLength": 5000
                },
                "priority": {
                  "type": "string",
                  "enum": ["low", "medium", "high", "urgent"],
                  "default": "medium"
                },
                "category": {
                  "type": "string",
                  "enum": ["technical", "billing", "general"]
                }
              },
              "required": ["subject", "description", "category"]
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Support ticket created",
            "schema": {
              "$ref": "#/definitions/SupportTicket"
            }
          }
        }
      }
    },
    "/support/tickets/{ticketId}": {
      "get": {
        "tags": ["Support"],
        "summary": "Get support ticket details",
        "parameters": [
          {
            "name": "ticketId",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "responses": {
          "200": {
            "description": "Support ticket details",
            "schema": {
              "$ref": "#/definitions/SupportTicketDetail"
            }
          }
        }
      }
    },
    "/support/tickets/{ticketId}/messages": {
      "post": {
        "tags": ["Support"],
        "summary": "Add message to support ticket",
        "parameters": [
          {
            "name": "ticketId",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "message": {
                  "type": "string",
                  "maxLength": 5000
                }
              },
              "required": ["message"]
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Message added",
            "schema": {
              "$ref": "#/definitions/SupportMessage"
            }
          }
        }
      }
    }
  },
  "definitions": {
    "AuthResponse": {
      "type": "object",
      "properties": {
        "accessToken": {
          "type": "string"
        },
        "refreshToken": {
          "type": "string"
        },
        "expiresIn": {
          "type": "integer"
        },
        "user": {
          "$ref": "#/definitions/CustomerProfile"
        }
      }
    },
    "CustomerProfile": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "name": {
          "type": "string"
        },
        "phone": {
          "type": "string"
        },
        "company": {
          "type": "string"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "CustomerProfileUpdate": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "phone": {
          "type": "string"
        },
        "company": {
          "type": "string"
        }
      }
    },
    "Purchase": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "stripeSessionId": {
          "type": "string"
        },
        "amount": {
          "type": "integer"
        },
        "currency": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": ["pending", "completed", "failed", "refunded"]
        },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "productType": {
                "type": "string",
                "enum": ["base_product"]
              },
              "description": {
                "type": "string"
              },
              "amount": {
                "type": "integer"
              },
              "quantity": {
                "type": "integer"
              }
            }
          }
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "PaymentMethod": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string"
        },
        "card": {
          "type": "object",
          "properties": {
            "brand": {
              "type": "string"
            },
            "last4": {
              "type": "string"
            },
            "expMonth": {
              "type": "integer"
            },
            "expYear": {
              "type": "integer"
            }
          }
        },
        "isDefault": {
          "type": "boolean"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "Invoice": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "stripeInvoiceId": {
          "type": "string"
        },
        "number": {
          "type": "string"
        },
        "amount": {
          "type": "integer"
        },
        "currency": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": ["draft", "open", "paid", "void", "uncollectible"]
        },
        "pdfUrl": {
          "type": "string",
          "format": "uri"
        },
        "dueDate": {
          "type": "string",
          "format": "date-time"
        },
        "paidAt": {
          "type": "string",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "License": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "key": {
          "type": "string"
        },
        "productType": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": ["active", "expired", "revoked"]
        },
        "expiresAt": {
          "type": "string",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "Download": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "version": {
          "type": "string"
        },
        "fileSize": {
          "type": "integer"
        },
        "releaseDate": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "SupportTicket": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "ticketNumber": {
          "type": "string"
        },
        "subject": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": ["open", "pending", "resolved", "closed"]
        },
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "urgent"]
        },
        "category": {
          "type": "string",
          "enum": ["technical", "billing", "general"]
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "SupportTicketDetail": {
      "allOf": [
        {
          "$ref": "#/definitions/SupportTicket"
        },
        {
          "type": "object",
          "properties": {
            "description": {
              "type": "string"
            },
            "messages": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/SupportMessage"
              }
            }
          }
        }
      ]
    },
    "SupportMessage": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "message": {
          "type": "string"
        },
        "fromCustomer": {
          "type": "boolean"
        },
        "author": {
          "type": "string"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "Pagination": {
      "type": "object",
      "properties": {
        "page": {
          "type": "integer"
        },
        "limit": {
          "type": "integer"
        },
        "total": {
          "type": "integer"
        },
        "pages": {
          "type": "integer"
        }
      }
    }
  }
}
